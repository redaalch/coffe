<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Coffee Masters</title>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0"
    />

    <!-- Dynamic path configuration for local and GitHub Pages -->
    <script>
      // Detect deployment environment and set base path
      window.APP_CONFIG = {
        basePath: (() => {
          const hostname = location.hostname;
          const pathname = location.pathname;

          // Local development (localhost, 127.0.0.1, etc.)
          if (
            hostname === "localhost" ||
            hostname === "127.0.0.1" ||
            hostname.startsWith("192.168.")
          ) {
            return "";
          }

          // GitHub Pages with repository name
          if (hostname.includes("github.io") && pathname.startsWith("/coffe")) {
            return "/coffe";
          }

          // Default fallback
          return "";
        })(),
      };

      // Helper function to get correct path
      window.getPath = function (relativePath) {
        return (
          window.APP_CONFIG.basePath + "/" + relativePath.replace(/^\/+/, "")
        );
      };
    </script>

    <!-- Load main app script dynamically -->
    <script>
      // Wait for DOM to be ready, then load the app
      document.addEventListener("DOMContentLoaded", function () {
        const appScript = document.createElement("script");
        appScript.src = getPath("app.js");
        appScript.type = "module";
        document.head.appendChild(appScript);
      });
    </script>

    <link rel="stylesheet" id="main-styles" />
    <link rel="manifest" id="app-manifest" />
    <link rel="apple-touch-icon" id="apple-icon" />
    <link rel="icon" id="favicon" />

    <script>
      // Set up all resource paths dynamically
      document.getElementById("main-styles").href = getPath("styles.css");
      document.getElementById("app-manifest").href = getPath("app.webmanifest");
      document.getElementById("apple-icon").href = getPath(
        "images/icons/icon.png"
      );
      document.getElementById("favicon").href = getPath(
        "images/icons/icon.png"
      );
    </script>

    <!-- GitHub Pages SPA routing fix -->
    <script>
      // Check if we were redirected from 404.html
      (function () {
        var redirectPath = sessionStorage.getItem("redirectPath");
        if (redirectPath) {
          sessionStorage.removeItem("redirectPath");
          history.replaceState(null, null, redirectPath);
        }
      })();
    </script>
  </head>

  <body>
    <header>
      <h1>
        <img id="logo-img" width="140" alt="Coffee Masters" />
        <script>
          document.getElementById("logo-img").src = getPath("images/logo.svg");
        </script>
      </h1>
      <nav>
        <a class="navlink material-symbols-outlined" id="linkHome" href="/">
          local_cafe
        </a>
        <a
          class="navlink material-symbols-outlined"
          id="linkOrder"
          href="/order"
        >
          shopping_cart
        </a>
        <span id="badge" hidden></span>
        <button
          class="navlink material-symbols-outlined"
          id="theme-toggle"
          title="Toggle dark mode"
        >
          dark_mode
        </button>
        <a
          class="navlink material-symbols-outlined"
          id="linkProfile"
          href="/profile"
        >
          account_circle
        </a>
        <a
          class="navlink material-symbols-outlined"
          id="linkAdmin"
          href="/admin"
          title="Admin Panel"
        >
          admin_panel_settings
        </a>
        <a class="navlink material-symbols-outlined" id="linkAuth" href="/auth">
          login
        </a>
      </nav>
    </header>

    <main></main>

    <template id="menu-page-template">
      <section>
        <ul id="menu"></ul>
      </section>
    </template>

    <template id="product-item-template">
      <article>
        <a href="#">
          <img />
          <section>
            <div>
              <h4></h4>
              <p class="price"></p>
              <p></p>
            </div>

            <button>Add</button>
          </section>
        </a>
      </article>
    </template>

    <template id="order-form-template">
      <form>
        <label for="name">Your Name</label>
        <input name="name" required />
        <label for="phone">Your Phone Number</label>
        <input name="phone" type="tel" />
        <label for="email">Your Email</label>
        <input name="email" type="email" />
        <button type="submit">Place Order</button>
      </form>
    </template>

    <template id="details-page-template">
      <header>
        <a href="#" onclick="app.router.go('/'); event.preventDefault()"
          >&lt; Back</a
        >
        <h2></h2>
        <a></a>
      </header>
      <img src="" />
      <p class="description"></p>
      <p class="price"></p>
      <button>Add to cart</button>
    </template>

    <template id="cart-item-template">
      <li>
        <img class="cart-item-image" src="" alt="" />
        <div class="cart-item-details">
          <p class="name"></p>
          <div class="qty"></div>
        </div>
        <p class="price"></p>
        <p class="toolbar">
          <a href="#" class="delete-button"> üóëÔ∏è </a>
        </p>
      </li>
    </template>

    <style>
      .qty-label {
        font-size: 12px;
        color: var(--color4, #b08968);
        margin: 0;
        font-weight: 500;
      }

      .quantity-controls {
        display: flex;
        align-items: center;
        gap: 0;
        background: var(--bg-color, white);
        border: 1px solid var(--border-color, #ddd);
        border-radius: 20px;
        padding: 2px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
      }

      .qty-btn {
        width: 24px;
        height: 24px;
        border: none;
        background: transparent;
        color: var(--text-color, #333);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-weight: bold;
        font-size: 12px;
        transition: all 0.2s ease;
      }

      .qty-btn:hover {
        background: var(--color1, #7f5539);
        color: white;
      }

      .qty-display {
        min-width: 30px;
        text-align: center;
        font-weight: 500;
        color: var(--text-color, #333);
        padding: 0 8px;
        line-height: 24px;
      }
    </style>
  </body>
</html>
